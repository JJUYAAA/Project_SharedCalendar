<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/locales-all.min.js'></script>
    <style>
        html, body {
            overflow: hidden;
            font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
            font-size: 14px;
        }
        .fc-header-toolbar {
            padding-top: 1em;
            padding-left: 1em;
            padding-right: 1em;
        }
    </style>
</head>
<body style="padding:30px;">
<div id='calendar-container'>
    <div id='calendar'></div>
</div>
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">일정 추가하기</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                일정이름 : <input type="text" id="title" /><br />
                시작시간 : <input type="datetime-local" id="start" /><br />
                종료시간 : <input type="datetime-local" id="end" /><br />
                배경색상 :
                <select id="color">
                    <option value="red">빨강색</option>
                    <option value="orange">주황색</option>
                    <option value="yellow">노랑색</option>
                    <option value="green">초록색</option>
                    <option value="blue">파랑색</option>
                    <option value="indigo">남색</option>
                    <option value="purple">보라색</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" id="saveChanges">추가</button>
            </div>
        </div>
    </div>
</div>
<script>
    $(function(){
        var calendarEl = $('#calendar')[0];
        var calendar = new FullCalendar.Calendar(calendarEl, {
            height: '700px',
            expandRows: true,
            slotMinTime: '08:00',
            slotMaxTime: '20:00',
            customButtons: {
                myCustomButton: {
                    text: "일정 추가",
                    click: function(){
                        $("#exampleModal").modal('show'); // 모달 보이기
                    }
                },

                mySaveButton: {
                    text: "일정 저장",
                    click: async function(){
                        if (confirm("저장하시겠습니까?")){
                            var allEvent = calendar.getEvents();
                            const saveEvent = await axios({
                                method: "POST",
                                url: "/calendar",
                                data: allEvent,
                            });
                        }
                    },
                }
            },

            headerToolbar: {
                left: 'prev,next today,myCustomButton,mySaveButton',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
            },
            initialView: 'dayGridMonth',
            navLinks: true,
            editable: true,
            selectable: true,
            nowIndicator: true,
            dayMaxEvents: true,
            locale: 'ko',
            events: function(fetchInfo, successCallback, failureCallback) {
                fetch('/api/schedules')
                    .then(response => response.json())
                    .then(data => successCallback(data))
                    .catch(error => failureCallback(error));
            },
            eventClick: function(info) {
                if (confirm("이 일정을 삭제하시겠습니까?")) {
                    info.event.remove();
                }
            }
        });

        calendar.render();

        $("#saveChanges").on("click", function () {
            var eventData = {
                title: $("#title").val(),
                start: $("#start").val(),
                end: $("#end").val(),
                color: $("#color").val(),
            };
            if (
                eventData.title == "" ||
                eventData.start == "" ||
                eventData.end == ""
            ) {
                alert("입력하지 않은 값이 있습니다.");
            } else if ($("#start").val() > $("#end").val()) {
                alert("시간을 잘못입력 하셨습니다.");
            } else {
                calendar.addEvent(eventData);
                $("#exampleModal").modal("hide");
                $("#title").val("");
                $("#start").val("");
                $("#end").val("");
                $("#color").val("");
            }
        });
    });
</script>
</body>
</html>

